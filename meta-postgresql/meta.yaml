{% set name = "meta-postgresql" %}
{% set version = "2021.03.3" %}
{% set filename = "Release_%s.tar.gz" % version.replace(".", "_") %}

package:
  name: {{ name|lower }}
  version: {{ version }}.2

source:
  - git_url: https://github.com/motoharu-yano/rdkit.git
    git_tag: Release_2021_03_3_pg_patch
    folder: rdkit_postgresql_src

  - git_url: https://github.com/motoharu-yano/pgsql-gzip.git
    git_tag: master
    folder: pgsql_gzip_postgresql_src

  - git_url: https://github.com/motoharu-yano/citus.git
    git_tag: development_01122021
    folder: citus_src

build:
  number: 0

requirements:
  build:
    - python {{ python }}                # [build_platform != target_platform]
    - cross-python_{{ target_platform }} # [build_platform != target_platform]
    - numpy                              # [build_platform != target_platform]
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - cmake
    - jom   # [win]
    - make   # [unix]
    - pkg-config   # [unix]
    - gxx_linux-64
    - sysroot_linux-64=2.17 # [unix]
    - autoconf # [unix]
  host:
    - python {{ python }}
    - libboost {{ libboost }}
    - boost-cpp
    - eigen
    - freetype
    - tzcode          # [not win]
    - tzdata          # [not win]
    - zlib
    - libcurl
    - lz4
    - lsof
    - postgresql {{ postgresql }}
    - postgresql-plpython {{ postgresql }}
    # msys chunk with diffutils is needed for tests
    - msys2-conda-epoch >=20160418 # [win]
    - m2-msys2-runtime # [win]
    - m2-libiconv # [win]
    - m2-libintl # [win]
    - m2-diffutils # [win]
    - m2-patch # [win]
  run:
    # drag python into dependencies - python version is needed for plpython and for rdkit 
    # there are build issues for different combinations of rdkit version + postgresql + python where cartridge may crash on tests
    # postgresql-plpython is also dragged into dependencies - better to install all extensions together with postgresql
    - python {{ python }}
    - libboost {{ libboost }}
    - postgresql {{ postgresql }}
    - postgresql-plpython {{ postgresql }}
    - freetype
    - tzcode          # [not win]
    - tzdata          # [not win]

outputs:
  - name: meta-postgresql

about:
  home: https://github.com/motoharu-yano/conda-rdkit
  license: 
  license_file: 
  summary: meta package with custom build of postgresql based on conda-forge recipe. contains postgresql-plpython, rdkit-postgresql, pgsql-gzip-postgresql, citus extensions.
  doc_url: https://github.com/motoharu-yano/conda-rdkit/blob/master/README.rst
  dev_url: https://github.com/motoharu-yano/conda-rdkit

extra:
  recipe-maintainers:
    - motoharu-yano
